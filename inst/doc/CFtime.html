<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Working with CFtime</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Working with CFtime</h1>



<div id="climate-change-models-and-calendars" class="section level2">
<h2>Climate change models and calendars</h2>
<p>Around the world, many climate change models are being developed
(100+) under the umbrella of the <a href="https://www.wcrp-climate.org">World Climate Research Programme</a>
to assess the rate of climate change. Published data is generally
publicly available to download for research and other (non-commercial)
purposes through partner organizations in the Earth Systems Grid
Federation.</p>
<p>The data are all formatted to comply with the <a href="http://cfconventions.org">CF Metadata Conventions</a>, a set of
standards to support standardization among research groups and published
data sets. These conventions greatly facilitate use and analysis of the
climate projections because standard processing work flows (should) work
across the various data sets.</p>
<p>On the flip side, the CF Metadata Conventions needs to cater to a
wide range of modeling requirements and that means that some of the
areas covered by the standards are more complex than might be assumed.
One of those areas is the temporal dimension of the data sets. The CF
Metadata Conventions supports no less than 12 different calendar
definitions, that, upon analysis, fall into 9 distinct calendars (from
the perspective of computation of climate projections):</p>
<ul>
<li><code>standard</code> (or <code>gregorian</code>): The Gregorian
calendar that is in common use in many countries around the world,
adopted by edict of Pope Gregory XIII in 1582 and in effect from 15
October of that year. The earliest valid time in this calendar is
0001-01-01 00:00:00 (1 January of year 1) as year 0 does not exist and
the CF Metadata Conventions require the year to be positive, but noting
that a Julian calendar is used in periods before the Gregorian calendar
was introduced.</li>
<li><code>proleptic_gregorian</code>: This is the Gregorian calendar
with validity extended to periods prior to <code>1582-10-15</code>,
including a year 0 and negative years. This calendar is the closest to
what is being used in most OSes and what is being used by R. The
difference is in leap seconds: while this calendar does not account for
them (and neither does POSIXt), most computers are periodically
synchronized against a time server running on UTC, which does include
leap seconds.</li>
<li><code>tai</code>: International Atomic Time, a global standard for
linear time: it counts seconds since its start at 1958-01-01 00:00:00.
For presentation it uses the Gregorian calendar. Timestamps prior to its
start are not allowed.</li>
<li><code>utc</code>: Coordinated Universal Time, the standard for civil
timekeeping all over the world. It is based on International Atomic Time
but it uses occasional leap seconds to remain synchronous with Earth’s
rotation around the Sun; at the end of 2024 it is 37 seconds behind
<code>tai</code>. It uses the Gregorian calendar with a start at
1972-01-01 00:00:00; earlier timestamps are not allowed. Future
timestamps are also not allowed because the insertion of leap seconds is
unpredictable. Most computer clocks synchronize with UTC but calculate
time intervals without accounting for leap seconds.</li>
<li><code>julian</code>: Adopted in the year 45 BCE, every fourth year
is a leap year. Originally, the Julian calendar did not have a
monotonically increasing year assigned to it and there are indeed
several Julian calendars in use around the world today with different
years assigned to them. Common interpretation is currently that the year
is the same as that of the Gregorian calendar. The Julian calendar is
currently 13 days behind the Gregorian calendar. As with the standard
calendar, the earliest valid time in this calendar is 0001-01-01
00:00:00.</li>
<li><code>365_day</code> or <code>noleap</code>: “Model time” in which
no years have a leap day. Negative years are allowed and year 0
exists.</li>
<li><code>366_day</code> or <code>all_leap</code>: “Model time” in which
all years have a leap day. Negative years are allowed and year 0
exists.</li>
<li><code>360_day</code>: “Model time” in which every year has 12 months
of 30 days each. Negative years are allowed and year 0 exists.</li>
<li><code>none</code>: Perpetual “calendar” for experiments that are
simulated on a given instant during the year. All the elements in this
calendar thus represent the same instant in time.</li>
</ul>
<p>The three calendars of model time are specific to the CF Metadata
Conventions to reduce computational complexities of working with dates.
None of the nine calendars are compliant with the standard
<code>POSIXt</code> date/time facilities in <code>R</code> and using
standard date/time functions would quickly lead to problems. See the
section on “CFtime and POSIXt”, below, for a detailed description of the
discrepancies between the CF calendars and POSIXt.</p>
<p>In the below code snippet, the date of <code>1949-12-01</code> is the
<em>origin</em> from which other dates are calculated. When adding
43,289 days to this origin for a data set that uses the
<code>360_day</code> calendar, that should yield a date some 120 years
after the origin:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co"># POSIXt calculations on a standard calendar - INCORRECT</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">as.Date</span>(<span class="st">&quot;1949-12-01&quot;</span>) <span class="sc">+</span> <span class="dv">43289</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="co">#&gt; [1] &quot;2068-06-08&quot;</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="co"># CFtime calculation on a &quot;360_day&quot; calendar - CORRECT</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="co"># See below examples for details on the two functions</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="fu">as_timestamp</span>(<span class="fu">CFtime</span>(<span class="st">&quot;days since 1949-12-01&quot;</span>, <span class="st">&quot;360_day&quot;</span>, <span class="dv">43289</span>))</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="co">#&gt; [1] &quot;2070-02-30&quot;</span></span></code></pre></div>
<p>Using standard <code>POSIXt</code> calculations gives a result that
is about 21 months off from the correct date - obviously an undesirable
situation. This example is far from artificial: <code>1949-12-01</code>
is the origin for all CORDEX data, covering the period 1950 - 2005 for
historical experiments and the period 2006 - 2100 for RCP experiments
(with some deviation between data sets), and several models used in the
CORDEX set use the <code>360_day</code> calendar. The
<code>365_day</code> or <code>noleap</code> calendar deviates by about 1
day every 4 years (disregarding centurial years), or about 24 days in a
century. The <code>366_day</code> or <code>all_leap</code> calendar
deviates by about 3 days every 4 years, or about 76 days in a
century.</p>
<p>The <code>CFtime</code> package deals with the complexity of the
different calendars allowed by the CF Metadata Conventions. It properly
formats dates and times (even oddball dates like
<code>2070-02-30</code>) and it can generate calendar-aware factors for
further processing of the data.</p>
<div id="time-zones" class="section level5">
<h5>Time zones</h5>
<p>The character of CF time series - a number of numerical offsets from
a base date - implies that there should only be a single time zone
associated with the time series, and then only for the
<code>standard</code> and <code>proleptic_gregorian</code> calendars.
For the other calendars a time zone can be set but it will have no
effect. Daylight savings time information is never considered by
<code>CFtime</code> so the user should take care to avoid entering times
with DST; DST should be accounted for by indicating the applicable DST
time zone.</p>
<p>The time zone offset from UTC is stored in the <code>CFTime</code>
instance and can be retrieved with the <code>timezone()</code> function.
If a vector of character timestamps with time zone information is parsed
with the <code>parse_timestamps()</code> function and the time zones are
found to be different from the <code>CFTime</code> time zone, a warning
message is generated but the timestamp is interpreted as being in the
<code>CFTime</code> time zone. No correction of timestamp to
<code>CFTime</code> time zone is performed.</p>
<p>The concept of time zones does not apply to the <code>utc</code> and
<code>tai</code> calendars as they represent universal time, i.e. the
indicated time is valid all over the globe. Timestamps passed to these
calendars should not have a time zone indicated, but if there are,
anything other than a 0 offset will generate an error.</p>
</div>
</div>
<div id="using-cftime-to-deal-with-calendars" class="section level2">
<h2>Using CFtime to deal with calendars</h2>
<p>Data sets that are compliant with the CF Metadata Conventions always
include a <em>origin</em>, a specific point in time in reference to a
specified <em>calendar</em>, from which other points in time are
calculated by adding a specified <em>offset</em> of a certain
<em>unit</em>. This approach is encapsulated in the <code>CFtime</code>
package by the R6 class <code>CFTime</code>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co"># Create a CFTime object from a definition string, a calendar and some offsets</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>(t <span class="ot">&lt;-</span> <span class="fu">CFtime</span>(<span class="st">&quot;days since 1949-12-01&quot;</span>, <span class="st">&quot;360_day&quot;</span>, <span class="dv">19830</span><span class="sc">:</span><span class="dv">90029</span>))</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="co">#&gt; CF calendar:</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="co">#&gt;   Origin  : 1949-12-01T00:00:00</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="co">#&gt;   Units   : days</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="co">#&gt;   Type    : 360_day</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a><span class="co">#&gt; Time series:</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a><span class="co">#&gt;   Elements: [2005-01-01 .. 2199-12-30] (average of 1.000000 days between 70200 elements)</span></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a><span class="co">#&gt;   Bounds  : not set</span></span></code></pre></div>
<p>The <code>CFtime()</code> function takes a description (which is
actually a unit - “days” - in reference to an origin - “1949-12-01”), a
calendar description, and a vector of <em>offsets</em> from that origin.
Once a <code>CFTime</code> instance is created its origin and calendar
cannot be changed anymore. Offsets may be added.</p>
<p>In practice, these parameters will be taken from the data set of
interest. CF Metadata Conventions require data sets to be in the netCDF
format, with all metadata describing the data set included in a single
file, including the mandatory “Conventions” global attribute which
should have a string identifying the version of the CF Metadata
Conventions that this file adheres to (among possible others). Not
surprisingly, all the pieces of interest are contained in the “time”
coordinate variables of the file. The process then becomes as follows,
for a CMIP6 file of daily precipitation.</p>
<blockquote>
<p>In this vignette we are using the <a href="https://cran.r-project.org/package=ncdfCF"><code>ncdfCF</code>
package</a> as that provides the easiest interface to work with netCDF
files. Package <code>CFtime</code> is integrated into
<code>ncdfCF</code> which makes working with time dimensions in netCDF
seamless.<br />
Packages <code>RNetCDF</code> and <code>ncdf4</code> can work with
<code>CFtime</code> as well but then the “intelligence” built into
<code>ncdfCF</code> is not available, such as automatically identifying
axes and data orientation. Other packages like <code>terra</code> and
<code>stars</code> are not recommended because they do not provide
access to the specifics of the time dimension of the data and do not
consider any calendars other than “proleptic_gregorian”.</p>
</blockquote>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co"># install.packages(&quot;ncdfCF&quot;)</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="fu">library</span>(ncdfCF)</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="co"># Opening a data file that is included with the package.</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="co"># Usually you would `list.files()` on a directory of your choice.</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>fn <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="at">path =</span> <span class="fu">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="at">package =</span> <span class="st">&quot;CFtime&quot;</span>), <span class="at">full.names =</span> <span class="cn">TRUE</span>)[<span class="dv">1</span>]</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>(ds <span class="ot">&lt;-</span> ncdfCF<span class="sc">::</span><span class="fu">open_ncdf</span>(fn))</span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="co">#&gt; &lt;Dataset&gt; pr_day_GFDL-ESM4_ssp245_r1i1p1f1_gr1_20150101-20991231_v20180701 </span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a><span class="co">#&gt; Resource   : /private/var/folders/gs/s0mmlczn4l7bjbmwfrrhjlt80000gn/T/RtmpWcpnPe/Rinst121ef69011376/CFtime/extdata/pr_day_GFDL-ESM4_ssp245_r1i1p1f1_gr1_20150101-20991231_v20180701.nc </span></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a><span class="co">#&gt; Format     : netcdf4 </span></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a><span class="co">#&gt; Type       : generic netCDF data </span></span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a><span class="co">#&gt; Conventions: CF-1.7 CMIP-6.0 UGRID-1.0 </span></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a><span class="co">#&gt; Keep open  : FALSE </span></span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a><span class="co">#&gt; Has groups : FALSE </span></span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a><span class="co">#&gt; Variable:</span></span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a><span class="co">#&gt;  name long_name     units      data_type axes          </span></span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a><span class="co">#&gt;  pr   Precipitation kg m-2 s-1 NC_FLOAT  lon, lat, time</span></span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a><span class="co">#&gt; Axes:</span></span>
<span id="cb3-21"><a href="#cb3-21" tabindex="-1"></a><span class="co">#&gt;  id axis name long_name     length</span></span>
<span id="cb3-22"><a href="#cb3-22" tabindex="-1"></a><span class="co">#&gt;  0       bnds vertex number     2 </span></span>
<span id="cb3-23"><a href="#cb3-23" tabindex="-1"></a><span class="co">#&gt;  1  Y    lat  latitude          1 </span></span>
<span id="cb3-24"><a href="#cb3-24" tabindex="-1"></a><span class="co">#&gt;  2  T    time               31025 </span></span>
<span id="cb3-25"><a href="#cb3-25" tabindex="-1"></a><span class="co">#&gt;  3  X    lon  longitude         1 </span></span>
<span id="cb3-26"><a href="#cb3-26" tabindex="-1"></a><span class="co">#&gt;  values                                        unit                 </span></span>
<span id="cb3-27"><a href="#cb3-27" tabindex="-1"></a><span class="co">#&gt;  [1 ... 2]                                                          </span></span>
<span id="cb3-28"><a href="#cb3-28" tabindex="-1"></a><span class="co">#&gt;  [-37.5]                                       degrees_north        </span></span>
<span id="cb3-29"><a href="#cb3-29" tabindex="-1"></a><span class="co">#&gt;  [2015-01-01T12:00:00 ... 2099-12-31T12:00:00] days since 1850-01-01</span></span>
<span id="cb3-30"><a href="#cb3-30" tabindex="-1"></a><span class="co">#&gt;  [175.625]                                     degrees_east         </span></span>
<span id="cb3-31"><a href="#cb3-31" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb3-32"><a href="#cb3-32" tabindex="-1"></a><span class="co">#&gt; Attributes:</span></span>
<span id="cb3-33"><a href="#cb3-33" tabindex="-1"></a><span class="co">#&gt;  id name                  type      length</span></span>
<span id="cb3-34"><a href="#cb3-34" tabindex="-1"></a><span class="co">#&gt;   0 external_variables    NC_CHAR     9   </span></span>
<span id="cb3-35"><a href="#cb3-35" tabindex="-1"></a><span class="co">#&gt;   1 history               NC_CHAR   124   </span></span>
<span id="cb3-36"><a href="#cb3-36" tabindex="-1"></a><span class="co">#&gt;   2 table_id              NC_CHAR     3   </span></span>
<span id="cb3-37"><a href="#cb3-37" tabindex="-1"></a><span class="co">#&gt;   3 activity_id           NC_CHAR    11   </span></span>
<span id="cb3-38"><a href="#cb3-38" tabindex="-1"></a><span class="co">#&gt;   4 branch_method         NC_CHAR     8   </span></span>
<span id="cb3-39"><a href="#cb3-39" tabindex="-1"></a><span class="co">#&gt;   5 branch_time_in_child  NC_DOUBLE   1   </span></span>
<span id="cb3-40"><a href="#cb3-40" tabindex="-1"></a><span class="co">#&gt;   6 branch_time_in_parent NC_DOUBLE   1   </span></span>
<span id="cb3-41"><a href="#cb3-41" tabindex="-1"></a><span class="co">#&gt;   7 comment               NC_CHAR    10   </span></span>
<span id="cb3-42"><a href="#cb3-42" tabindex="-1"></a><span class="co">#&gt;   8 contact               NC_CHAR    32   </span></span>
<span id="cb3-43"><a href="#cb3-43" tabindex="-1"></a><span class="co">#&gt;   9 Conventions           NC_CHAR    25   </span></span>
<span id="cb3-44"><a href="#cb3-44" tabindex="-1"></a><span class="co">#&gt;  10 creation_date         NC_CHAR    20   </span></span>
<span id="cb3-45"><a href="#cb3-45" tabindex="-1"></a><span class="co">#&gt;  11 data_specs_version    NC_CHAR     8   </span></span>
<span id="cb3-46"><a href="#cb3-46" tabindex="-1"></a><span class="co">#&gt;  12 experiment            NC_CHAR    30   </span></span>
<span id="cb3-47"><a href="#cb3-47" tabindex="-1"></a><span class="co">#&gt;  13 experiment_id         NC_CHAR     6   </span></span>
<span id="cb3-48"><a href="#cb3-48" tabindex="-1"></a><span class="co">#&gt;  14 forcing_index         NC_INT      1   </span></span>
<span id="cb3-49"><a href="#cb3-49" tabindex="-1"></a><span class="co">#&gt;  15 frequency             NC_CHAR     3   </span></span>
<span id="cb3-50"><a href="#cb3-50" tabindex="-1"></a><span class="co">#&gt;  16 further_info_url      NC_CHAR    77   </span></span>
<span id="cb3-51"><a href="#cb3-51" tabindex="-1"></a><span class="co">#&gt;  17 grid                  NC_CHAR    94   </span></span>
<span id="cb3-52"><a href="#cb3-52" tabindex="-1"></a><span class="co">#&gt;  18 grid_label            NC_CHAR     3   </span></span>
<span id="cb3-53"><a href="#cb3-53" tabindex="-1"></a><span class="co">#&gt;  19 initialization_index  NC_INT      1   </span></span>
<span id="cb3-54"><a href="#cb3-54" tabindex="-1"></a><span class="co">#&gt;  20 institution           NC_CHAR   112   </span></span>
<span id="cb3-55"><a href="#cb3-55" tabindex="-1"></a><span class="co">#&gt;  21 institution_id        NC_CHAR     9   </span></span>
<span id="cb3-56"><a href="#cb3-56" tabindex="-1"></a><span class="co">#&gt;  22 license               NC_CHAR   805   </span></span>
<span id="cb3-57"><a href="#cb3-57" tabindex="-1"></a><span class="co">#&gt;  23 mip_era               NC_CHAR     5   </span></span>
<span id="cb3-58"><a href="#cb3-58" tabindex="-1"></a><span class="co">#&gt;  24 nominal_resolution    NC_CHAR     6   </span></span>
<span id="cb3-59"><a href="#cb3-59" tabindex="-1"></a><span class="co">#&gt;  25 parent_activity_id    NC_CHAR     4   </span></span>
<span id="cb3-60"><a href="#cb3-60" tabindex="-1"></a><span class="co">#&gt;  26 parent_experiment_id  NC_CHAR    10   </span></span>
<span id="cb3-61"><a href="#cb3-61" tabindex="-1"></a><span class="co">#&gt;  27 parent_mip_era        NC_CHAR     5   </span></span>
<span id="cb3-62"><a href="#cb3-62" tabindex="-1"></a><span class="co">#&gt;  28 parent_source_id      NC_CHAR     9   </span></span>
<span id="cb3-63"><a href="#cb3-63" tabindex="-1"></a><span class="co">#&gt;  29 parent_time_units     NC_CHAR    19   </span></span>
<span id="cb3-64"><a href="#cb3-64" tabindex="-1"></a><span class="co">#&gt;  30 parent_variant_label  NC_CHAR     8   </span></span>
<span id="cb3-65"><a href="#cb3-65" tabindex="-1"></a><span class="co">#&gt;  31 physics_index         NC_INT      1   </span></span>
<span id="cb3-66"><a href="#cb3-66" tabindex="-1"></a><span class="co">#&gt;  32 product               NC_CHAR    12   </span></span>
<span id="cb3-67"><a href="#cb3-67" tabindex="-1"></a><span class="co">#&gt;  33 realization_index     NC_INT      1   </span></span>
<span id="cb3-68"><a href="#cb3-68" tabindex="-1"></a><span class="co">#&gt;  34 realm                 NC_CHAR     5   </span></span>
<span id="cb3-69"><a href="#cb3-69" tabindex="-1"></a><span class="co">#&gt;  35 source                NC_CHAR   560   </span></span>
<span id="cb3-70"><a href="#cb3-70" tabindex="-1"></a><span class="co">#&gt;  36 source_id             NC_CHAR     9   </span></span>
<span id="cb3-71"><a href="#cb3-71" tabindex="-1"></a><span class="co">#&gt;  37 source_type           NC_CHAR    18   </span></span>
<span id="cb3-72"><a href="#cb3-72" tabindex="-1"></a><span class="co">#&gt;  38 sub_experiment        NC_CHAR     4   </span></span>
<span id="cb3-73"><a href="#cb3-73" tabindex="-1"></a><span class="co">#&gt;  39 sub_experiment_id     NC_CHAR     4   </span></span>
<span id="cb3-74"><a href="#cb3-74" tabindex="-1"></a><span class="co">#&gt;  40 title                 NC_CHAR    82   </span></span>
<span id="cb3-75"><a href="#cb3-75" tabindex="-1"></a><span class="co">#&gt;  41 tracking_id           NC_CHAR    49   </span></span>
<span id="cb3-76"><a href="#cb3-76" tabindex="-1"></a><span class="co">#&gt;  42 variable_id           NC_CHAR     2   </span></span>
<span id="cb3-77"><a href="#cb3-77" tabindex="-1"></a><span class="co">#&gt;  43 variant_info          NC_CHAR     3   </span></span>
<span id="cb3-78"><a href="#cb3-78" tabindex="-1"></a><span class="co">#&gt;  44 references            NC_CHAR    30   </span></span>
<span id="cb3-79"><a href="#cb3-79" tabindex="-1"></a><span class="co">#&gt;  45 variant_label         NC_CHAR     8   </span></span>
<span id="cb3-80"><a href="#cb3-80" tabindex="-1"></a><span class="co">#&gt;  value                                              </span></span>
<span id="cb3-81"><a href="#cb3-81" tabindex="-1"></a><span class="co">#&gt;  areacella                                          </span></span>
<span id="cb3-82"><a href="#cb3-82" tabindex="-1"></a><span class="co">#&gt;  File was processed by fremetar (GFDL analog of ... </span></span>
<span id="cb3-83"><a href="#cb3-83" tabindex="-1"></a><span class="co">#&gt;  day                                                </span></span>
<span id="cb3-84"><a href="#cb3-84" tabindex="-1"></a><span class="co">#&gt;  ScenarioMIP                                        </span></span>
<span id="cb3-85"><a href="#cb3-85" tabindex="-1"></a><span class="co">#&gt;  standard                                           </span></span>
<span id="cb3-86"><a href="#cb3-86" tabindex="-1"></a><span class="co">#&gt;  60225                                              </span></span>
<span id="cb3-87"><a href="#cb3-87" tabindex="-1"></a><span class="co">#&gt;  60225                                              </span></span>
<span id="cb3-88"><a href="#cb3-88" tabindex="-1"></a><span class="co">#&gt;  &lt;null ref&gt;                                         </span></span>
<span id="cb3-89"><a href="#cb3-89" tabindex="-1"></a><span class="co">#&gt;  gfdl.climate.model.info@noaa.gov                   </span></span>
<span id="cb3-90"><a href="#cb3-90" tabindex="-1"></a><span class="co">#&gt;  CF-1.7 CMIP-6.0 UGRID-1.0                          </span></span>
<span id="cb3-91"><a href="#cb3-91" tabindex="-1"></a><span class="co">#&gt;  2019-06-18T05:29:00Z                               </span></span>
<span id="cb3-92"><a href="#cb3-92" tabindex="-1"></a><span class="co">#&gt;  01.00.27                                           </span></span>
<span id="cb3-93"><a href="#cb3-93" tabindex="-1"></a><span class="co">#&gt;  update of RCP4.5 based on SSP2                     </span></span>
<span id="cb3-94"><a href="#cb3-94" tabindex="-1"></a><span class="co">#&gt;  ssp245                                             </span></span>
<span id="cb3-95"><a href="#cb3-95" tabindex="-1"></a><span class="co">#&gt;  1                                                  </span></span>
<span id="cb3-96"><a href="#cb3-96" tabindex="-1"></a><span class="co">#&gt;  day                                                </span></span>
<span id="cb3-97"><a href="#cb3-97" tabindex="-1"></a><span class="co">#&gt;  https://furtherinfo.es-doc.org/CMIP6.NOAA-GFDL.... </span></span>
<span id="cb3-98"><a href="#cb3-98" tabindex="-1"></a><span class="co">#&gt;  atmos data regridded from Cubed-sphere (c96) to... </span></span>
<span id="cb3-99"><a href="#cb3-99" tabindex="-1"></a><span class="co">#&gt;  gr1                                                </span></span>
<span id="cb3-100"><a href="#cb3-100" tabindex="-1"></a><span class="co">#&gt;  1                                                  </span></span>
<span id="cb3-101"><a href="#cb3-101" tabindex="-1"></a><span class="co">#&gt;  National Oceanic and Atmospheric Administration... </span></span>
<span id="cb3-102"><a href="#cb3-102" tabindex="-1"></a><span class="co">#&gt;  NOAA-GFDL                                          </span></span>
<span id="cb3-103"><a href="#cb3-103" tabindex="-1"></a><span class="co">#&gt;  CMIP6 model data produced by NOAA-GFDL is licen... </span></span>
<span id="cb3-104"><a href="#cb3-104" tabindex="-1"></a><span class="co">#&gt;  CMIP6                                              </span></span>
<span id="cb3-105"><a href="#cb3-105" tabindex="-1"></a><span class="co">#&gt;  100 km                                             </span></span>
<span id="cb3-106"><a href="#cb3-106" tabindex="-1"></a><span class="co">#&gt;  CMIP                                               </span></span>
<span id="cb3-107"><a href="#cb3-107" tabindex="-1"></a><span class="co">#&gt;  historical                                         </span></span>
<span id="cb3-108"><a href="#cb3-108" tabindex="-1"></a><span class="co">#&gt;  CMIP6                                              </span></span>
<span id="cb3-109"><a href="#cb3-109" tabindex="-1"></a><span class="co">#&gt;  GFDL-ESM4                                          </span></span>
<span id="cb3-110"><a href="#cb3-110" tabindex="-1"></a><span class="co">#&gt;  days since 1850-1-1                                </span></span>
<span id="cb3-111"><a href="#cb3-111" tabindex="-1"></a><span class="co">#&gt;  r1i1p1f1                                           </span></span>
<span id="cb3-112"><a href="#cb3-112" tabindex="-1"></a><span class="co">#&gt;  1                                                  </span></span>
<span id="cb3-113"><a href="#cb3-113" tabindex="-1"></a><span class="co">#&gt;  model-output                                       </span></span>
<span id="cb3-114"><a href="#cb3-114" tabindex="-1"></a><span class="co">#&gt;  1                                                  </span></span>
<span id="cb3-115"><a href="#cb3-115" tabindex="-1"></a><span class="co">#&gt;  atmos                                              </span></span>
<span id="cb3-116"><a href="#cb3-116" tabindex="-1"></a><span class="co">#&gt;  GFDL-ESM4 (2018):\natmos: GFDL-AM4.1 (Cubed-sphe...</span></span>
<span id="cb3-117"><a href="#cb3-117" tabindex="-1"></a><span class="co">#&gt;  GFDL-ESM4                                          </span></span>
<span id="cb3-118"><a href="#cb3-118" tabindex="-1"></a><span class="co">#&gt;  AOGCM AER CHEM BGC                                 </span></span>
<span id="cb3-119"><a href="#cb3-119" tabindex="-1"></a><span class="co">#&gt;  none                                               </span></span>
<span id="cb3-120"><a href="#cb3-120" tabindex="-1"></a><span class="co">#&gt;  none                                               </span></span>
<span id="cb3-121"><a href="#cb3-121" tabindex="-1"></a><span class="co">#&gt;  NOAA GFDL GFDL-ESM4 model output prepared for C... </span></span>
<span id="cb3-122"><a href="#cb3-122" tabindex="-1"></a><span class="co">#&gt;  hdl:21.14100/48767401-8960-4864-8738-e64640bef71d  </span></span>
<span id="cb3-123"><a href="#cb3-123" tabindex="-1"></a><span class="co">#&gt;  pr                                                 </span></span>
<span id="cb3-124"><a href="#cb3-124" tabindex="-1"></a><span class="co">#&gt;  N/A                                                </span></span>
<span id="cb3-125"><a href="#cb3-125" tabindex="-1"></a><span class="co">#&gt;  see further_info_url attribute                     </span></span>
<span id="cb3-126"><a href="#cb3-126" tabindex="-1"></a><span class="co">#&gt;  r1i1p1f1</span></span>
<span id="cb3-127"><a href="#cb3-127" tabindex="-1"></a></span>
<span id="cb3-128"><a href="#cb3-128" tabindex="-1"></a><span class="co"># &quot;Conventions&quot; global attribute must have a string like &quot;CF-1.*&quot; for this package to work reliably</span></span>
<span id="cb3-129"><a href="#cb3-129" tabindex="-1"></a></span>
<span id="cb3-130"><a href="#cb3-130" tabindex="-1"></a><span class="co"># Look at the &quot;time&quot; axis</span></span>
<span id="cb3-131"><a href="#cb3-131" tabindex="-1"></a>(time <span class="ot">&lt;-</span> ds[[<span class="st">&quot;time&quot;</span>]])</span>
<span id="cb3-132"><a href="#cb3-132" tabindex="-1"></a><span class="co">#&gt; &lt;Time axis&gt; [2] time</span></span>
<span id="cb3-133"><a href="#cb3-133" tabindex="-1"></a><span class="co">#&gt; Length   : 31025</span></span>
<span id="cb3-134"><a href="#cb3-134" tabindex="-1"></a><span class="co">#&gt; Axis     : T </span></span>
<span id="cb3-135"><a href="#cb3-135" tabindex="-1"></a><span class="co">#&gt; Calendar : noleap </span></span>
<span id="cb3-136"><a href="#cb3-136" tabindex="-1"></a><span class="co">#&gt; Range    : 2015-01-01T12:00:00 ... 2099-12-31T12:00:00 (days) </span></span>
<span id="cb3-137"><a href="#cb3-137" tabindex="-1"></a><span class="co">#&gt; Bounds   : 2015-01-01 ... 2100-01-01 </span></span>
<span id="cb3-138"><a href="#cb3-138" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb3-139"><a href="#cb3-139" tabindex="-1"></a><span class="co">#&gt; Attributes:</span></span>
<span id="cb3-140"><a href="#cb3-140" tabindex="-1"></a><span class="co">#&gt;  id name          type    length value                </span></span>
<span id="cb3-141"><a href="#cb3-141" tabindex="-1"></a><span class="co">#&gt;  0  long_name     NC_CHAR  4     time                 </span></span>
<span id="cb3-142"><a href="#cb3-142" tabindex="-1"></a><span class="co">#&gt;  1  axis          NC_CHAR  1     T                    </span></span>
<span id="cb3-143"><a href="#cb3-143" tabindex="-1"></a><span class="co">#&gt;  2  calendar_type NC_CHAR  6     noleap               </span></span>
<span id="cb3-144"><a href="#cb3-144" tabindex="-1"></a><span class="co">#&gt;  3  bounds        NC_CHAR  9     time_bnds            </span></span>
<span id="cb3-145"><a href="#cb3-145" tabindex="-1"></a><span class="co">#&gt;  4  standard_name NC_CHAR  4     time                 </span></span>
<span id="cb3-146"><a href="#cb3-146" tabindex="-1"></a><span class="co">#&gt;  5  description   NC_CHAR 13     Temporal mean        </span></span>
<span id="cb3-147"><a href="#cb3-147" tabindex="-1"></a><span class="co">#&gt;  6  units         NC_CHAR 21     days since 1850-01-01</span></span>
<span id="cb3-148"><a href="#cb3-148" tabindex="-1"></a><span class="co">#&gt;  7  calendar      NC_CHAR  6     noleap</span></span>
<span id="cb3-149"><a href="#cb3-149" tabindex="-1"></a></span>
<span id="cb3-150"><a href="#cb3-150" tabindex="-1"></a><span class="co"># Get the CFTime instance from the &quot;time&quot; axis</span></span>
<span id="cb3-151"><a href="#cb3-151" tabindex="-1"></a>(t <span class="ot">&lt;-</span> time<span class="sc">$</span><span class="fu">time</span>())</span>
<span id="cb3-152"><a href="#cb3-152" tabindex="-1"></a><span class="co">#&gt; CF calendar:</span></span>
<span id="cb3-153"><a href="#cb3-153" tabindex="-1"></a><span class="co">#&gt;   Origin  : 1850-01-01T00:00:00</span></span>
<span id="cb3-154"><a href="#cb3-154" tabindex="-1"></a><span class="co">#&gt;   Units   : days</span></span>
<span id="cb3-155"><a href="#cb3-155" tabindex="-1"></a><span class="co">#&gt;   Type    : noleap</span></span>
<span id="cb3-156"><a href="#cb3-156" tabindex="-1"></a><span class="co">#&gt; Time series:</span></span>
<span id="cb3-157"><a href="#cb3-157" tabindex="-1"></a><span class="co">#&gt;   Elements: [2015-01-01T12:00:00 .. 2099-12-31T12:00:00] (average of 1.000000 days between 31025 elements)</span></span>
<span id="cb3-158"><a href="#cb3-158" tabindex="-1"></a><span class="co">#&gt;   Bounds  : irregular</span></span></code></pre></div>
<p>You can see from the global attribute “Conventions” that the file
adheres to the CF Metadata Conventions, among others. According to the
CF conventions, <code>units</code> and <code>calendar</code> are
required attributes of the “time” dimension in the netCDF file.</p>
<p>The above example (and others in this vignette) use the
<code>ncdfCF</code> package. If you are using the <code>RNetCDF</code>
or <code>ncdf4</code> package, checking for CF conventions and then
creating a <code>CFTime</code> instance goes like this:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="fu">library</span>(RNetCDF)</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>nc <span class="ot">&lt;-</span> <span class="fu">open.nc</span>(fn)</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="fu">att.get.nc</span>(nc, <span class="sc">-</span><span class="dv">1</span>, <span class="st">&quot;Conventions&quot;</span>)</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">CFtime</span>(<span class="fu">att.get.nc</span>(nc, <span class="st">&quot;time&quot;</span>, <span class="st">&quot;units&quot;</span>), </span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>            <span class="fu">att.get.nc</span>(nc, <span class="st">&quot;time&quot;</span>, <span class="st">&quot;calendar&quot;</span>), </span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>            <span class="fu">var.get.nc</span>(nc, <span class="st">&quot;time&quot;</span>))</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a><span class="fu">library</span>(ncdf4)</span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>nc <span class="ot">&lt;-</span> <span class="fu">nc_open</span>(fn)</span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a><span class="fu">nc_att_get</span>(nc, <span class="dv">0</span>, <span class="st">&quot;Conventions&quot;</span>)</span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">CFtime</span>(nc<span class="sc">$</span>dim<span class="sc">$</span>time<span class="sc">$</span>units, </span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a>            nc<span class="sc">$</span>dim<span class="sc">$</span>time<span class="sc">$</span>calendar, </span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a>            nc<span class="sc">$</span>dim<span class="sc">$</span>time<span class="sc">$</span>vals)</span></code></pre></div>
<p>The character representations of the time series can be easily
generated:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>dates <span class="ot">&lt;-</span> t<span class="sc">$</span><span class="fu">as_timestamp</span>(<span class="at">format =</span> <span class="st">&quot;date&quot;</span>)</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>dates[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;2015-01-01&quot; &quot;2015-01-02&quot; &quot;2015-01-03&quot; &quot;2015-01-04&quot; &quot;2015-01-05&quot;</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="co">#&gt;  [6] &quot;2015-01-06&quot; &quot;2015-01-07&quot; &quot;2015-01-08&quot; &quot;2015-01-09&quot; &quot;2015-01-10&quot;</span></span></code></pre></div>
<p>…as well as the range of the time series:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>t<span class="sc">$</span><span class="fu">range</span>()</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="co">#&gt; [1] &quot;2015-01-01T12:00:00&quot; &quot;2099-12-31T12:00:00&quot;</span></span></code></pre></div>
<p>Note that in this latter case, if any of the timestamps in the time
series have a time that is other than <code>00:00:00</code> then the
time of the extremes of the time series is also displayed. This is a
common occurrence because the CF Metadata Conventions prescribe that the
middle of the time period (month, day, etc) is recorded, which for
months with 31 days would be something like
<code>2005-01-15T12:00:00</code>.</p>
</div>
<div id="supporting-processing-of-climate-projection-data" class="section level2">
<h2>Supporting processing of climate projection data</h2>
<p>When working with high resolution climate projection data, typically
at a “day” resolution, one of the processing steps would be to aggregate
the data to some lower resolution such as a dekad (10-day period), a
month or a meteorological season, and then compute a derivative value
such as the dekadal sum of precipitation, monthly minimum/maximum daily
temperature, or seasonal average daily short-wave irradiance.</p>
<p>It is also possible to create factors for multiple “eras” in one go.
This greatly reduces programming effort if you want to calculate
anomalies over multiple future periods. A complete example is provided
in the vignette <a href="Processing.html">“Processing climate projection
data”</a>.</p>
<p>It is easy to generate the factors that you need once you have a
<code>CFTime</code> instance prepared:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="co"># Create a dekad factor for the whole `t` time series that was created above</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>f_k <span class="ot">&lt;-</span> t<span class="sc">$</span><span class="fu">factor</span>(<span class="st">&quot;dekad&quot;</span>)</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="fu">str</span>(f_k)</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a><span class="co">#&gt;  Factor w/ 3060 levels &quot;2015D01&quot;,&quot;2015D02&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a><span class="co">#&gt;  - attr(*, &quot;era&quot;)= int -1</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a><span class="co">#&gt;  - attr(*, &quot;period&quot;)= chr &quot;dekad&quot;</span></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a><span class="co">#&gt;  - attr(*, &quot;CFTime&quot;)=CFTime with origin [days since 1850-01-01] using calendar [noleap] having 3060 offset values</span></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a><span class="co"># Create monthly factors for a baseline era and early, mid and late 21st century eras</span></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a>baseline <span class="ot">&lt;-</span> t<span class="sc">$</span><span class="fu">factor</span>(<span class="at">era =</span> <span class="dv">1991</span><span class="sc">:</span><span class="dv">2020</span>)</span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a>future <span class="ot">&lt;-</span> t<span class="sc">$</span><span class="fu">factor</span>(<span class="at">era =</span> <span class="fu">list</span>(<span class="at">early =</span> <span class="dv">2021</span><span class="sc">:</span><span class="dv">2040</span>, <span class="at">mid =</span> <span class="dv">2041</span><span class="sc">:</span><span class="dv">2060</span>, <span class="at">late =</span> <span class="dv">2061</span><span class="sc">:</span><span class="dv">2080</span>))</span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a><span class="fu">str</span>(future)</span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a><span class="co">#&gt; List of 3</span></span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a><span class="co">#&gt;  $ early: Factor w/ 12 levels &quot;01&quot;,&quot;02&quot;,&quot;03&quot;,..: NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a><span class="co">#&gt;   ..- attr(*, &quot;era&quot;)= int 20</span></span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a><span class="co">#&gt;   ..- attr(*, &quot;period&quot;)= chr &quot;month&quot;</span></span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a><span class="co">#&gt;   ..- attr(*, &quot;CFTime&quot;)=CFClimatology with origin [days since 1850-01-01] using calendar [noleap] having 12 offset values $ mid  : Factor w/ 12 levels &quot;01&quot;,&quot;02&quot;,&quot;03&quot;,..: NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a><span class="co">#&gt;   ..- attr(*, &quot;era&quot;)= int 20</span></span>
<span id="cb7-19"><a href="#cb7-19" tabindex="-1"></a><span class="co">#&gt;   ..- attr(*, &quot;period&quot;)= chr &quot;month&quot;</span></span>
<span id="cb7-20"><a href="#cb7-20" tabindex="-1"></a><span class="co">#&gt;   ..- attr(*, &quot;CFTime&quot;)=CFClimatology with origin [days since 1850-01-01] using calendar [noleap] having 12 offset values $ late : Factor w/ 12 levels &quot;01&quot;,&quot;02&quot;,&quot;03&quot;,..: NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span id="cb7-21"><a href="#cb7-21" tabindex="-1"></a><span class="co">#&gt;   ..- attr(*, &quot;era&quot;)= int 20</span></span>
<span id="cb7-22"><a href="#cb7-22" tabindex="-1"></a><span class="co">#&gt;   ..- attr(*, &quot;period&quot;)= chr &quot;month&quot;</span></span>
<span id="cb7-23"><a href="#cb7-23" tabindex="-1"></a><span class="co">#&gt;   ..- attr(*, &quot;CFTime&quot;)=CFClimatology with origin [days since 1850-01-01] using calendar [noleap] having 12 offset values</span></span></code></pre></div>
<p>For the “era” version, there are two interesting things to note
here:</p>
<ul>
<li>The eras do not have to coincide with the boundaries of the time
series. In the example above, the time series starts in 2015, while the
baseline era is from 1991. Obviously, the number of time steps from the
time series that then fall within this era will then be reduced.</li>
<li>The factor is always of the same length as the time series, with
<code>NA</code> values where the time series values are not falling in
the era. This ensures that the factor is compatible with the data set
which the time series describes, such that functions like
<code>tapply()</code> will not throw an error.</li>
</ul>
<p>There are six periods defined for factoring:</p>
<ul>
<li><code>year</code>, to summarize data to yearly timescales</li>
<li><code>season</code>, the meteorological seasons. Note that the month
of December will be added to the months of January and February of the
following year, so the date “2020-12-01” yields the factor value
“2021S1”.</li>
<li><code>quarter</code>, the standard quarters of the year.</li>
<li><code>month</code>, monthly summaries, the default period.</li>
<li><code>dekad</code>, 10-day period. Each month is subdivided in
dekads as follows: (1) days 01 - 10; (2) days 11 - 20; (3) remainder of
the month.</li>
<li><code>day</code>, to summarize sub-daily data.</li>
</ul>
<div id="new-time-dimension" class="section level5">
<h5>New “time” dimension</h5>
<p>A <code>CFTime</code> instance describes the “time” dimension of an
associated data set. When you process that dimension of the data set
using <code>CFTime$factor()</code> or another method to filter or
otherwise subset the “time” dimension, the resulting data set will have
a different “time” dimension. To associate a proper <code>CFTime</code>
instance with your processing result, the methods in this package return
that <code>CFTime</code> instance as an attribute:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>  (new_time <span class="ot">&lt;-</span> <span class="fu">attr</span>(f_k, <span class="st">&quot;CFTime&quot;</span>))</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="co">#&gt; CF calendar:</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="co">#&gt;   Origin  : 1850-01-01T00:00:00</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="co">#&gt;   Units   : days</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="co">#&gt;   Type    : noleap</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a><span class="co">#&gt; Time series:</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="co">#&gt;   Elements: [2015-01-06T00:00:00 .. 2099-12-26T12:00:00] (average of 10.138771 days between 3060 elements)</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a><span class="co">#&gt;   Bounds  : regular and consecutive</span></span></code></pre></div>
<p>In the vignette <a href="Processing.html">“Processing climate
projection data”</a> is a fully worked out example of this.</p>
</div>
<div id="incomplete-time-series" class="section level5">
<h5>Incomplete time series</h5>
<p>You can test if your time series is complete with the function
<code>is_complete()</code>. A time series is considered complete if the
time steps between the two extreme values are equally spaced. There is a
“fuzzy” assessment of completeness for time series with a datum unit of
“days” or smaller where the time steps are months or years apart - these
have different lengths in days in different months or years (e.g. a leap
year).</p>
<p>If your time series is incomplete, for instance because it has
missing time steps, you should recognize that in your further
processing. As an example, you might want to filter out months that have
fewer than 90% of daily data from further processing or apply weights
based on the actual coverage.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="co"># Is the time series complete?</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="fu">is_complete</span>(t)</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="co"># How many time units fit in a factor level?</span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>t<span class="sc">$</span><span class="fu">factor_units</span>(baseline)</span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a><span class="co">#&gt;  [1] 31 28 31 30 31 30 31 31 30 31 30 31</span></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a><span class="co"># What&#39;s the absolute and relative coverage of our time series</span></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a>t<span class="sc">$</span><span class="fu">factor_coverage</span>(baseline, <span class="st">&quot;absolute&quot;</span>)</span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a><span class="co">#&gt;  [1] 186 168 186 180 186 180 186 186 180 186 180 186</span></span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a>t<span class="sc">$</span><span class="fu">factor_coverage</span>(baseline, <span class="st">&quot;relative&quot;</span>)</span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a><span class="co">#&gt;  [1] 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2</span></span></code></pre></div>
<p>The time series is complete but coverage of the baseline era is only
20%! Recall that the time series starts in 2015 while the baseline
period in the factor is for <code>1991:2020</code> so that’s only 6
years of time series data out of 30 years of the baseline factor.</p>
<p>An artificial example of missing data:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="co"># 4 years of data on a `365_day` calendar, keep 80% of values</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">365</span> <span class="sc">*</span> <span class="dv">4</span></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>cov <span class="ot">&lt;-</span> <span class="fl">0.8</span></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>offsets <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">0</span><span class="sc">:</span>(n<span class="dv">-1</span>), n <span class="sc">*</span> cov)</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>(t <span class="ot">&lt;-</span> <span class="fu">CFtime</span>(<span class="st">&quot;days since 2020-01-01&quot;</span>, <span class="st">&quot;365_day&quot;</span>, offsets))</span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a><span class="co">#&gt; Warning: Offsets not monotonically increasing.</span></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a><span class="co">#&gt; CF calendar:</span></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a><span class="co">#&gt;   Origin  : 2020-01-01T00:00:00</span></span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a><span class="co">#&gt;   Units   : days</span></span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a><span class="co">#&gt;   Type    : 365_day</span></span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a><span class="co">#&gt; Time series:</span></span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a><span class="co">#&gt;   Elements: [2020-01-02 .. 2023-12-31] (average of 1.249357 days between 1168 elements)</span></span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a><span class="co">#&gt;   Bounds  : not set</span></span>
<span id="cb10-15"><a href="#cb10-15" tabindex="-1"></a><span class="co"># Note that there are about 1.25 days between observations</span></span>
<span id="cb10-16"><a href="#cb10-16" tabindex="-1"></a></span>
<span id="cb10-17"><a href="#cb10-17" tabindex="-1"></a>mon <span class="ot">&lt;-</span> t<span class="sc">$</span><span class="fu">factor</span>(<span class="st">&quot;month&quot;</span>)</span>
<span id="cb10-18"><a href="#cb10-18" tabindex="-1"></a>t<span class="sc">$</span><span class="fu">factor_coverage</span>(mon, <span class="st">&quot;absolute&quot;</span>)</span>
<span id="cb10-19"><a href="#cb10-19" tabindex="-1"></a><span class="co">#&gt;  [1] 20 20 26 23 24 25 22 25 29 24 22 22 25 24 22 24 23 24 21 24 25 26 27 27 25</span></span>
<span id="cb10-20"><a href="#cb10-20" tabindex="-1"></a><span class="co">#&gt; [26] 28 27 28 24 25 26 25 22 25 25 24 25 19 27 24 29 21 22 28 24 27 20 24</span></span>
<span id="cb10-21"><a href="#cb10-21" tabindex="-1"></a>t<span class="sc">$</span><span class="fu">factor_coverage</span>(mon, <span class="st">&quot;relative&quot;</span>)</span>
<span id="cb10-22"><a href="#cb10-22" tabindex="-1"></a><span class="co">#&gt;  [1] 0.6451613 0.7142857 0.8387097 0.7666667 0.7741935 0.8333333 0.7096774</span></span>
<span id="cb10-23"><a href="#cb10-23" tabindex="-1"></a><span class="co">#&gt;  [8] 0.8064516 0.9666667 0.7741935 0.7333333 0.7096774 0.8064516 0.8571429</span></span>
<span id="cb10-24"><a href="#cb10-24" tabindex="-1"></a><span class="co">#&gt; [15] 0.7096774 0.8000000 0.7419355 0.8000000 0.6774194 0.7741935 0.8333333</span></span>
<span id="cb10-25"><a href="#cb10-25" tabindex="-1"></a><span class="co">#&gt; [22] 0.8387097 0.9000000 0.8709677 0.8064516 1.0000000 0.8709677 0.9333333</span></span>
<span id="cb10-26"><a href="#cb10-26" tabindex="-1"></a><span class="co">#&gt; [29] 0.7741935 0.8333333 0.8387097 0.8064516 0.7333333 0.8064516 0.8333333</span></span>
<span id="cb10-27"><a href="#cb10-27" tabindex="-1"></a><span class="co">#&gt; [36] 0.7741935 0.8064516 0.6785714 0.8709677 0.8000000 0.9354839 0.7000000</span></span>
<span id="cb10-28"><a href="#cb10-28" tabindex="-1"></a><span class="co">#&gt; [43] 0.7096774 0.9032258 0.8000000 0.8709677 0.6666667 0.7741935</span></span></code></pre></div>
<p>Keep in mind, though, that there are data sets where the time unit is
lower than the intended resolution of the data. Since the CF conventions
recommend that the coarsest time unit is “day”, many files with monthly
data sets have a definition like <code>days since 2016-01-01</code> with
offset values for the middle of the month like
<code>15, 44, 74, 104, ...</code>. Even in these scenarios you can
verify that your data set is complete with the function
<code>CFcomplete()</code>.</p>
</div>
</div>
<div id="cftime-and-posixt" class="section level2">
<h2>CFtime and POSIXt</h2>
<p>The CF Metadata Conventions supports 11 different calendars
(disregarding <code>none</code> here). None of these are fully
compatible with POSIXt, the basis for timekeeping on virtually all
computers. The reason for this is that POSIXt does not consider leap
seconds (just like the <code>tai</code> calendar) but computer clocks
are periodically synchronized using Network Time Protocol servers that
report UTC time. The problem is easily demonstrated:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="co"># 1972-01-01 is the origin of UTC, when leap seconds came into existence</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="fu">difftime</span>(<span class="fu">as.POSIXct</span>(<span class="st">&quot;2024-01-01&quot;</span>), <span class="fu">as.POSIXct</span>(<span class="st">&quot;1972-01-01&quot;</span>), <span class="at">units =</span> <span class="st">&quot;sec&quot;</span>)</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a><span class="co">#&gt; Time difference of 1640995200 secs</span></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a><span class="co"># CFtime with a &quot;utc&quot; calendar</span></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a>t <span class="ot">&lt;-</span> CFTime<span class="sc">$</span><span class="fu">new</span>(<span class="st">&quot;seconds since 1972-01-01&quot;</span>, <span class="st">&quot;utc&quot;</span>, <span class="st">&quot;2024-01-01&quot;</span>)</span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a>t<span class="sc">$</span>offsets</span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a><span class="co">#&gt; [1] 1640995227</span></span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a><span class="co"># Leap seconds in UTC</span></span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a>.leap.seconds</span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;1972-07-01 GMT&quot; &quot;1973-01-01 GMT&quot; &quot;1974-01-01 GMT&quot; &quot;1975-01-01 GMT&quot;</span></span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a><span class="co">#&gt;  [5] &quot;1976-01-01 GMT&quot; &quot;1977-01-01 GMT&quot; &quot;1978-01-01 GMT&quot; &quot;1979-01-01 GMT&quot;</span></span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a><span class="co">#&gt;  [9] &quot;1980-01-01 GMT&quot; &quot;1981-07-01 GMT&quot; &quot;1982-07-01 GMT&quot; &quot;1983-07-01 GMT&quot;</span></span>
<span id="cb11-15"><a href="#cb11-15" tabindex="-1"></a><span class="co">#&gt; [13] &quot;1985-07-01 GMT&quot; &quot;1988-01-01 GMT&quot; &quot;1990-01-01 GMT&quot; &quot;1991-01-01 GMT&quot;</span></span>
<span id="cb11-16"><a href="#cb11-16" tabindex="-1"></a><span class="co">#&gt; [17] &quot;1992-07-01 GMT&quot; &quot;1993-07-01 GMT&quot; &quot;1994-07-01 GMT&quot; &quot;1996-01-01 GMT&quot;</span></span>
<span id="cb11-17"><a href="#cb11-17" tabindex="-1"></a><span class="co">#&gt; [21] &quot;1997-07-01 GMT&quot; &quot;1999-01-01 GMT&quot; &quot;2006-01-01 GMT&quot; &quot;2009-01-01 GMT&quot;</span></span>
<span id="cb11-18"><a href="#cb11-18" tabindex="-1"></a><span class="co">#&gt; [25] &quot;2012-07-01 GMT&quot; &quot;2015-07-01 GMT&quot; &quot;2017-01-01 GMT&quot;</span></span></code></pre></div>
<p><code>difftime()</code> is off by 27 seconds, the number of leap
seconds in UTC since their introduction in 1972. Your computer may have
the correct time based on UTC, but calculations over periods that
include leap seconds are always off by a number of seconds.</p>
<div id="duh" class="section level5">
<h5>Duh!</h5>
<p>If 27 seconds is of no concern to you or your application - perhaps
your data has a daily resolution - then you can safely forget about the
leap seconds in several of the calendars, in particular
<code>standard</code> (for periods after 1582-10-15),
<code>proleptic_gregorian</code> and <code>tai</code>. The
<code>utc</code> calendar does account for leap seconds so consider if
you should use that - this is the only calendar that considers leap
seconds in calculation. These calendars support the generation of
timestamps in POSIXct with the <code>as_timestamp()</code> function but
note the potential for a discrepancy due to the presence of leap
seconds.</p>
</div>
<div id="when-seconds-count" class="section level5">
<h5>When seconds count</h5>
<p>If second accuracy is of concern, then you should carefully consider
the time keeping in the source of your data and use a matching calendar.
The <code>utc</code> calendar is a sensible option if your equipment
synchronizes time with an NTP server or a computer that does so. Even
then you should ensure that time is accurate before your first new
observation after a new leap second is introduced.</p>
</div>
<div id="bigger-problems" class="section level5">
<h5>Bigger problems</h5>
<p>The other calendars have discrepancies with POSIXt that are much
larger, namely one or more days. These calendars do not support POSIXct
timestamps and an error will be thrown if you try. If you really want
the timestamps in POSIXct then you can generate the timestamps as
character strings using this package, and then convert to a
<code>POSIXct</code> or <code>Date</code> using the available R tools.
Converting time series using these incompatible calendars to
<code>POSIXct</code> or <code>Date</code> is likely to produce problems.
This is most pronounced for the <code>360_day</code> calendar:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="co"># Days in January and February</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">CFtime</span>(<span class="st">&quot;days since 2023-01-01&quot;</span>, <span class="st">&quot;360_day&quot;</span>, <span class="dv">0</span><span class="sc">:</span><span class="dv">59</span>)</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>ts_days <span class="ot">&lt;-</span> t<span class="sc">$</span><span class="fu">as_timestamp</span>(<span class="st">&quot;date&quot;</span>)</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a><span class="fu">as.Date</span>(ts_days)</span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;2023-01-01&quot; &quot;2023-01-02&quot; &quot;2023-01-03&quot; &quot;2023-01-04&quot; &quot;2023-01-05&quot;</span></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a><span class="co">#&gt;  [6] &quot;2023-01-06&quot; &quot;2023-01-07&quot; &quot;2023-01-08&quot; &quot;2023-01-09&quot; &quot;2023-01-10&quot;</span></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a><span class="co">#&gt; [11] &quot;2023-01-11&quot; &quot;2023-01-12&quot; &quot;2023-01-13&quot; &quot;2023-01-14&quot; &quot;2023-01-15&quot;</span></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a><span class="co">#&gt; [16] &quot;2023-01-16&quot; &quot;2023-01-17&quot; &quot;2023-01-18&quot; &quot;2023-01-19&quot; &quot;2023-01-20&quot;</span></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a><span class="co">#&gt; [21] &quot;2023-01-21&quot; &quot;2023-01-22&quot; &quot;2023-01-23&quot; &quot;2023-01-24&quot; &quot;2023-01-25&quot;</span></span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a><span class="co">#&gt; [26] &quot;2023-01-26&quot; &quot;2023-01-27&quot; &quot;2023-01-28&quot; &quot;2023-01-29&quot; &quot;2023-01-30&quot;</span></span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a><span class="co">#&gt; [31] &quot;2023-02-01&quot; &quot;2023-02-02&quot; &quot;2023-02-03&quot; &quot;2023-02-04&quot; &quot;2023-02-05&quot;</span></span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a><span class="co">#&gt; [36] &quot;2023-02-06&quot; &quot;2023-02-07&quot; &quot;2023-02-08&quot; &quot;2023-02-09&quot; &quot;2023-02-10&quot;</span></span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a><span class="co">#&gt; [41] &quot;2023-02-11&quot; &quot;2023-02-12&quot; &quot;2023-02-13&quot; &quot;2023-02-14&quot; &quot;2023-02-15&quot;</span></span>
<span id="cb12-14"><a href="#cb12-14" tabindex="-1"></a><span class="co">#&gt; [46] &quot;2023-02-16&quot; &quot;2023-02-17&quot; &quot;2023-02-18&quot; &quot;2023-02-19&quot; &quot;2023-02-20&quot;</span></span>
<span id="cb12-15"><a href="#cb12-15" tabindex="-1"></a><span class="co">#&gt; [51] &quot;2023-02-21&quot; &quot;2023-02-22&quot; &quot;2023-02-23&quot; &quot;2023-02-24&quot; &quot;2023-02-25&quot;</span></span>
<span id="cb12-16"><a href="#cb12-16" tabindex="-1"></a><span class="co">#&gt; [56] &quot;2023-02-26&quot; &quot;2023-02-27&quot; &quot;2023-02-28&quot; NA           NA</span></span></code></pre></div>
<p>31 January is missing from the vector of <code>Date</code>s because
the <code>360_day</code> calendar does not include it and 29 and 30
February are <code>NA</code>s because POSIXt rejects them. This will
produce problems later on when processing your data.</p>
<p>The general advice is therefore: <strong>do not convert CFTime
objects to Date objects</strong> unless you are sure that the
<code>CFTime</code> object uses a POSIXt-compatible calendar.</p>
<p>The degree of incompatibility for the various calendars is as
follows:</p>
<ul>
<li><code>standard</code>: Only valid for periods after 1582-10-15. The
preceeding period uses the Julian calendar.</li>
<li><code>julian</code>: Every fouth year is a leap year. Dates like
<code>2100-02-29</code> and <code>2200-02-29</code> are valid.</li>
<li><code>365_day</code> or <code>noleap</code>: No leap year exists.
<code>2020-02-29</code> does not occur.</li>
<li><code>366_day</code> or <code>all_leap</code>: All years are leap
years.</li>
<li><code>360_day</code>: All months have 30 days in every year. This
means that 31 January, March, May, July, August, October and December
never occur, while 29 and 30 February occur in every year.</li>
</ul>
</div>
<div id="so-how-do-i-compare-climate-projection-data-with-different-calendars" class="section level5">
<h5>So how do I compare climate projection data with different
calendars?</h5>
<p>One reason to convert the time dimension from different climate
projection data sets is to be able to compare the data from different
models and produce a multi-model ensemble. The correct procedure to do
this is to first calculate <strong>for each data set
individually</strong> the property of interest (e.g. average daily
rainfall per month anomaly for some future period relative to a baseline
period), which will typically involve aggregation to a lower resolution
(such as from daily data to monthly averages), and only then combine the
aggregate data from multiple data sets to compute statistically
interesting properties (such as average among models and standard
deviation, etc).</p>
<p>Once data is aggregated from daily or higher-resolution values to a
lower temporal resolution - such as a “month” - the different calendars
no longer matter (although if you do need to convert averaged data
(e.g. average daily precipitation in a month) to absolute data
(e.g. precipitation per month) you should use
<code>CFfactor_units()</code> to make sure that you use the correct
scaling factor).</p>
<p>Otherwise, there really shouldn’t be any reason to convert the time
series in the data files to <code>Date</code>s. Climate projection data
is virtually never compared on a day-to-day basis between different
models and neither does complex date arithmetic make much sense (such as
adding intervals) - <code>CFtime</code> can support basic arithmetic by
manipulation the offsets of the <code>CFTime</code> object. The
character representations that are produced are perfectly fine to use
for <code>dimnames()</code> on an array or as <code>rownames()</code> in
a <code>data.frame</code> and these also support basic logical
operations such as <code>&quot;2023-02-30&quot; &lt; &quot;2023-03-01&quot;</code>. So ask
yourself, do you really need <code>Date</code>s when working with
unprocessed climate projection data? (If so, <a href="https://github.com/pvanlaake/CFtime/issues">open an issue on
GitHub</a>).</p>
<p>A complete example of creating a multi-model ensemble is provided in
the vignette <a href="Processing.html">“Processing climate projection
data”</a>.</p>
</div>
</div>
<div id="final-observations" class="section level2">
<h2>Final observations</h2>
<ul>
<li>This package is intended to facilitate processing of climate
projection data. It is a near-complete implementation of the CF Metadata
Conventions “time” component.</li>
<li>In parsing and deparsing of offsets and timestamps, data is rounded
to 3 digits of precision of the unit of the calendar. When using a
description of time that is very different from the calendar unit, this
may lead to some loss of precision due to rounding errors. For instance,
if milli-second precision is required, use a unit of “seconds”. The
authors have no knowledge of published climate projection data that
requires milli-second precision so for the intended use of the package
this issue is marginal.</li>
</ul>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
